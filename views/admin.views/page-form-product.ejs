<%- include('./layouts/head.ejs', { pageTitle: 'Add product' }) %>


    <body>
        <div class="screen-overlay"></div>

        <%- include ('./partials/admin.aside.ejs') %>


            <main class="main-wrap">

                <%- include ('./partials/admin.home.header.ejs') %>


                    <section class="content-main">

                        <% if (typeof(errorMessage) !=="undefined" ) { %>
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error!',
                                        text: '<%= errorMessage %>',
                                        showConfirmButton: true,
                                        confirmButtonText: 'OK',
                                        customClass: {
                                            confirmButton: 'btn btn-danger', // Add custom class for styling
                                        },
                                    });
                                });
                            </script>
                            <% } %>

                                <% if (typeof(successMessage) !=="undefined" ) { %>
                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            Swal.fire({
                                                icon: 'success',
                                                title: 'Success!',
                                                text: '<%= successMessage %>',
                                                showConfirmButton: true,
                                                confirmButtonText: 'OK',
                                                customClass: {
                                                    confirmButton: 'btn btn-success', // Add custom class for styling
                                                },
                                            });
                                        });
                                    </script>
                                    <% } %>



                                        <div class="row">
                                            <div class="col-9">
                                                <div class="content-header">
                                                    <h2 class="content-title">Add New Product</h2>

                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="card mb-4">
                                                    <div class="card-header">
                                                        <h4>Basic</h4>
                                                    </div>
                                                    <div class="card-body">
                                                        <form action="" method="post" enctype="multipart/form-data"
                                                            onsubmit="return validateForm()">
                                                            <div class="mb-4">
                                                                <label for="product_name" class="form-label">Product
                                                                    name</label>
                                                                <input type="text" placeholder="Type here"
                                                                    class="form-control" id="name" name="name"
                                                                    autocomplete="on" id="name"
                                                                    oninput="validateFieldName()">
                                                                <div id="nameError" class="text-danger"></div>
                                                            </div>
                                                            <div class="mb-4">
                                                                <label class="form-label">Full description</label>
                                                                <textarea placeholder="Type here" class="form-control"
                                                                    rows="4" name="description"
                                                                    oninput="validateProductDescription()"
                                                                    id="description"></textarea>
                                                                <div id="descriptionError" class="text-danger"></div>

                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-4">
                                                                    <div class="mb-4">
                                                                        <label class="form-label">Price</label>
                                                                        <div class="row gx-2">
                                                                            <input placeholder="&#8377;" type="text"
                                                                                class="form-control" name="price"
                                                                                id="price" oninput="validatePrice()">
                                                                        </div>
                                                                        <div id="priceError" class="text-danger"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-4">
                                                                    <div class="mb-4">
                                                                        <label class="form-label">Current Stock</label>
                                                                        <input placeholder="" type="text"
                                                                            class="form-control" name="stock"
                                                                            oninput="validateStock()" id="stock">
                                                                    </div>
                                                                    <div id="stockError" class="text-danger"></div>
                                                                </div>
                                                                <!-- <div class="col-lg-4">
                                        <label class="form-label">Currency</label>
                                        <select class="form-select">
                                            <option> USD </option>
                                            <option> EUR </option>
                                            <option> RUBL </option>
                                        </select>
                                    </div> -->
                                                            </div>
                                                            <!-- <div class="mb-4">
                                            <label class="form-label">Band Material</label>
                                            <input type="text" placeholder="" class="form-control" id="product_name"
                                                name="bandMaterial">
                                        </div> -->

                                                            <label class="mb-4"></label>
                                                            <select class="form-select" name="bandMaterial">
                                                                <option selected disabled> Band material </option>
                                                                <option> Titanium </option>
                                                                <option> Metal </option>
                                                                <option> Leather </option>

                                                            </select>

                                                            <label class="mb-4"></label>
                                                            <select class="form-select" name="dialColor">
                                                                <option selected disabled> Dial color </option>

                                                                <option> Black </option>
                                                                <option> Blue </option>
                                                                <option> Brown </option>

                                                            </select>
                                                            <!-- <div class="mb-4">
                                            <label class="form-label">Dial Color</label>
                                            <input type="text" placeholder="" class="form-control" id="product_name"
                                                name="dialColor">
                                        </div> -->
                                                            <!-- <label class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" value="">
                                    <span class="form-check-label"> Make a template </span>
                                </label> -->

                                                    </div>
                                                </div> <!-- card end// -->
                                                <!-- <div class="card mb-4">
                        <div class="card-header">
                            <h4>Shipping</h4>
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="product_name" class="form-label">Width</label>
                                            <input type="text" placeholder="inch" class="form-control" id="product_name">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="product_name" class="form-label">Height</label>
                                            <input type="text" placeholder="inch" class="form-control" id="product_name">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="product_name" class="form-label">Weight</label>
                                    <input type="text" placeholder="gam" class="form-control" id="product_name">
                                </div>
                                <div class="mb-4">
                                    <label for="product_name" class="form-label">Shipping fees</label>
                                    <input type="text" placeholder="$" class="form-control" id="product_name">
                                </div>
                            </form>
                        </div>
                    </div>  -->
                                            </div>
                                            <div class="col-lg-5">
                                                <div class="card mb-4">
                                                    <div class="card-header">
                                                        <h4>Media</h4>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="input-upload">
                                                            <img src="/admin.assets/imgs/theme/upload.svg" alt="">
                                                            <input class="form-control" type="file" multiple
                                                                name="images" id="images"
                                                                onchange="validateImageUpload()">
                                                            <div id="imgContainer"></div>

                                                            <div id="descriptionErrordescriptionError"
                                                                style="position: relative; display: inline-block"
                                                                class="text-danger"></div>
                                                        </div>
                                                    </div>
                                                </div> <!-- card end// -->
                                                <div class="card mb-4">
                                                    <div class="card-header">
                                                        <!-- <h4>Category</h4> -->
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row gx-2">


                                                            <div class="col-sm-12 mb-3">
                                                                <label class="form-label"></label>

                                                                <select class="form-select" name="categoryPath">
                                                                    <option value="" selected disabled>Category</option>
                                                                    <% if(typeof(categoryPathArr)!=="undefined" ) %>
                                                                        <% for(let i=0; i<categoryPathArr.length; i++) {
                                                                            %>
                                                                            <option>
                                                                                <%= categoryPathArr[i].path %>
                                                                            </option>
                                                                            <%}%>
                                                                </select>
                                                            </div>
                                                            <!-- <div class="col-sm-6 mb-3">
                                            <label class="form-label">Sub-category</label>
                                            <select class="form-select">
                                                <option> Nissan </option>
                                                <option> Honda </option>
                                                <option> Mercedes </option>
                                                <option> Chevrolet </option>
                                            </select>
                                        </div> -->
                                                            <!-- <div class="mb-4">
                                    <label for="product_name" class="form-label">Tags</label>
                                    <input type="text" class="form-control">
                                </div> -->

                                                        </div> <!-- row.// -->
                                                        <div>
                                                           
                                                            <button type="submit"
                                                                class="btn btn-md rounded font-sm hover-up">Save</button>
                                                        </div>
                                                    </div>
                                                    </form>
                                                </div> <!-- card end// -->
                                            </div>
                                        </div>
                    </section> <!-- content-main end// -->

                    <!--Footer-->
                    <%- include ('./partials/admin.footer.ejs') %>

            </main>

            <script>
                function validateFieldName() {
                    const element = document.getElementById("name");
                    const nameErrorElement = document.getElementById("nameError");

                    if (element.value.length < 3 || element.value.length > 30 || !/^[A-Z]/.test(element.value)) {
                        nameErrorElement.innerHTML = "Name should be 3 to 30 characters and start with an uppercase letter";
                    } else {
                        nameErrorElement.innerHTML = "";
                    }
                }

                function validateProductDescription() {
                    const descriptionElement = document.getElementById("description");
                    const descriptionErrorElement = document.getElementById("descriptionError");

                    const descriptionValue = descriptionElement.value.trim();

                    if (descriptionValue.length < 10 || descriptionValue.length > 1000) {
                        descriptionErrorElement.innerHTML = "Product description should be between 10 and 1000 characters";
                    } else {
                        descriptionErrorElement.innerHTML = "";
                    }
                }
                function validatePrice() {
                    const priceElement = document.getElementById("price");
                    const priceErrorElement = document.getElementById("priceError");

                    const priceValue = priceElement.value.trim();

                    if (priceValue === "") {
                        priceErrorElement.innerHTML = "Price cannot be empty";
                    } else if (isNaN(priceValue) || !/^\d+(\.\d{1,2})?$/.test(priceValue)) {
                        priceErrorElement.innerHTML = "Price must be a valid number";
                    } else if (priceValue < 0) {
                        priceErrorElement.innerHTML = "Price cannot be negative";
                    } else {
                        priceErrorElement.innerHTML = "";
                    }
                }

                function validateStock() {
                    const stockElement = document.getElementById("stock");
                    const stockErrorElement = document.getElementById("stockError");

                    const stockValue = stockElement.value.trim();

                    if (stockValue === "") {
                        stockErrorElement.innerHTML = "Stock cannot be empty";
                    } else if (isNaN(stockValue) || !/^\d+(\.\d{1,2})?$/.test(stockValue)) {
                        stockErrorElement.innerHTML = "Stock must be a valid number";
                    } else if (parseFloat(stockValue) < 0) {
                        stockErrorElement.innerHTML = "Stock cannot be negative";
                    } else {
                        stockErrorElement.innerHTML = "";
                    }
                }



                function validateImageUpload() {
                    const imgContainer = document.getElementById("imgContainer");

                    // Clear previous images
                    imgContainer.innerHTML = "";

                    // Loop through all selected files
                    for (const file of event.target.files) {

                        const liElement = document.createElement("li")

                        // Create an image element
                        const imgElement = document.createElement("img");

                        // Set the object URL for the file
                        imgElement.src = URL.createObjectURL(file);


                        // Create a remove button
                        // const removeButton = document.createElement("a");
                        // removeButton.textContent = "Remove";
                        // removeButton.className = "btn-brand"
                        // removeButton.classList.add("btn-md")
                        // removeButton.style.float = "right";
                        // removeButton.style.margin = "15px"


                        // removeButton.addEventListener("click", () => {
                        //     // Remove the image and the button when clicked
                        //     imgContainer.removeChild(liElement);

                        //     let fileInput = document.getElementById("images")
                        //     fileInput = Array.from(fileInput.files)
                        //     fileInput.splice(1,1)
                        //     console.log(fileInput);




                        // });



                        // Append the image element and remove button to the container
                        imgContainer.appendChild(liElement);
                        liElement.appendChild(imgElement);
                        // liElement.appendChild(removeButton);
                    }

                    const imagesElement = document.getElementById("images");
                    const imagesErrorElement = document.getElementById("imagesError");

                    const selectedFiles = imagesElement.files;
                    const numFiles = selectedFiles.length;

                    if (numFiles < 3 || numFiles > 5) {
                        imagesErrorElement.innerHTML = "Please select 3 to 5 images";
                    } else {
                        imagesErrorElement.innerHTML = "";
                    }


                }

                function validateForm() {

                    // Call individual validation functions
                    validateFieldName();
                    validateProductDescription();
                    validatePrice();
                    validateStock();
                    validateImageUpload()

                     console.log("HAI");

                    if (
                        nameError.innerHTML !== "" ||
                        descriptionErrorpriceError.innerHTML !== "" ||
                        priceError.innerHTML !== "" ||
                        stockError.innerHTML !== ""||
                        imagesError.innerHTML !== ""
                    ) {
                        return false;
                        console.log("HELLO");
                    }

                     console.log("HELLO");
                    // All fields are valid, continue with form submission
                    return true;
                }



            </script>

            <script src="/admin.assets/js/vendors/jquery-3.6.0.min.js"></script>
            <script src="/admin.assets/js/vendors/bootstrap.bundle.min.js"></script>
            <script src="/admin.assets/js/vendors/select2.min.js"></script>
            <script src="/admin.assets/js/vendors/perfect-scrollbar.js"></script>
            <script src="/admin.assets/js/vendors/jquery.fullscreen.min.js"></script>
            <!-- Main Script -->
            <script src="/admin.assets/js/main.js" type="text/javascript"></script>

            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>

    </body>

    </html>